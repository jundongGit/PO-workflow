# 更新日志

本文档记录项目的所有重要变更。

## [1.0.0] - 2025-10-24

### 🎉 首次发布

#### ✨ 新增功能

##### AI智能识别
- **GPT-4 Vision集成**: 使用OpenAI GPT-4o模型进行智能PDF识别
- **自动PDF转图片**: 使用系统Poppler工具将PDF转换为图片
- **智能数据提取**: 自动识别Invoice Number和Client Order Number
- **置信度评估**: AI提供识别置信度和详细说明
- **容错机制**: AI识别失败时自动回退到正则表达式识别

##### 用户界面增强
- **实时进度条**: 多阶段进度追踪（10% → 30% → 60% → 100%）
- **流光动画**: 渐变进度条配合流光效果
- **动态状态**: 实时显示当前处理阶段
  - 上传PDF文件中...
  - PDF转图片处理中...
  - AI智能识别中...
  - 识别完成

##### 文件管理系统
- **智能存储**: 保留原始文件名和完整元数据
- **文件列表API**: `GET /api/files` 查看所有已上传文件
- **文件查询API**: `GET /api/files/:id` 获取单个文件详情
- **文件删除API**: `DELETE /api/files/:id` 删除指定文件
- **文件大小限制**: 10MB上传限制
- **自动目录创建**: 上传目录和临时目录自动创建

##### 后端API增强
- **多处理方式**: 支持AI识别和正则识别切换
- **元数据管理**: 内存Map存储文件元数据
- **详细日志**: 完整的服务器端日志记录
- **健康检查**: `/api/health` 端点含文件统计

#### 🔧 技术改进

##### 依赖更新
```json
{
  "openai": "^latest",
  "dotenv": "^latest",
  "sharp": "^latest"
}
```

##### 新增文件
- `server/src/aiProcessor.js`: AI识别核心逻辑
- `server/.env`: 环境变量配置
- `uploads/temp/`: PDF转图片临时目录

##### 代码优化
- 添加进度状态管理（React Hooks）
- 实现阶段性进度更新
- 优化错误处理和回退机制
- 添加详细的代码注释

#### 🎨 样式更新

##### 新增CSS类
```css
.progress-container      /* 进度条容器 */
.progress-bar            /* 进度条主体 */
.progress-fill           /* 进度条填充 */
.progress-shine          /* 流光动画 */
.processing-details      /* 详情卡片（已移除） */
```

##### 动画效果
- `@keyframes shine`: 进度条流光动画
- 平滑过渡效果（transition: width 0.3s ease）
- 渐变背景（linear-gradient）

#### 📚 文档完善

##### README.md 更新
- ✅ 添加AI功能说明
- ✅ 添加环境变量配置指南
- ✅ 添加完整API文档
- ✅ 添加故障排除章节
- ✅ 添加技术架构图
- ✅ 添加路线图

##### 新增文档
- `CHANGELOG.md`: 版本变更记录
- API文档完整示例
- 配置说明详解

#### 🐛 修复问题
- 修复pdf-poppler库依赖问题（改用系统poppler）
- 修复文件上传时的元数据丢失
- 修复进度条显示时机
- 移除不必要的识别详情信息卡片

#### ⚙️ 配置变更

##### 环境变量
新增必需配置：
```env
OPENAI_API_KEY=your_key_here
PORT=3001
NODE_ENV=development
```

##### Git配置
更新 `.gitignore`:
```
uploads/*
!uploads/.gitkeep
server/.env
uploads/temp/*
```

#### 📦 部署说明

##### 系统要求
- Node.js v14+
- Poppler (pdftoppm命令)
- OpenAI API Key

##### 安装步骤
1. 安装系统依赖：`brew install poppler`
2. 配置环境变量：创建 `server/.env`
3. 安装npm包：`npm install`
4. 启动应用：`npm run dev`

#### 🔒 安全性

- ✅ 环境变量隔离（.env文件）
- ✅ API Key不提交到git
- ✅ 文件大小限制（10MB）
- ✅ PDF文件类型验证
- ✅ 临时文件自动清理

#### 📈 性能

- ⚡ PDF转图片优化
- ⚡ 进度条平滑动画
- ⚡ AI响应时间约10-15秒
- ⚡ 文件上传流式处理

---

### 技术债务

暂无重大技术债务。

### 已知问题

1. 文件元数据存储在内存中，服务器重启后丢失
   - 计划：v1.1版本添加数据库支持

2. 仅支持单文件上传
   - 计划：v1.2版本添加批量上传

3. AI识别费用无法实时统计
   - 计划：v1.3版本添加费用追踪

---

## 下一个版本计划

### [1.1.0] - 计划中
- [ ] 数据库持久化（MongoDB/SQLite）
- [ ] 处理历史记录查看
- [ ] 操作日志系统

### [1.2.0] - 计划中
- [ ] 批量文件上传
- [ ] 拖拽上传支持
- [ ] Procore自动化完整流程

---

**格式说明**:
- 🎉 重大更新
- ✨ 新功能
- 🔧 技术改进
- 🎨 样式更新
- 📚 文档
- 🐛 Bug修复
- ⚙️ 配置
- 📦 部署
- 🔒 安全
- 📈 性能
