# 可视化操作步骤指南

## 🎯 概述

现在自动化执行时，您可以清楚地看到每一步操作！

## ✨ 新增功能

### 1. 浮动进度面板

**位置**：右下角

**内容**：
- 🤖 实时状态消息
- 🔄 加载动画
- ✓ 步骤进度列表

**特点**：
- ✅ 不遮挡页面内容
- ✅ 实时更新进度
- ✅ 渐变紫色设计
- ✅ 滑入动画

### 2. 元素高亮

**效果**：
- 紫色发光边框
- 脉冲动画
- 自动滚动到视图

**触发时机**：
- 点击按钮前
- 填写输入框前
- 选择下拉菜单前

### 3. 操作提示气泡

**显示内容**：
- 当前操作描述
- 例如："点击项目选择器"、"填写发票号: 335397"

**位置**：
- 在被操作元素上方
- 带箭头指向元素

**动画**：
- 弹跳进入
- 自动消失

### 4. 步骤进度

**4个主要步骤**：
1. ⏳ → 🔄 → ✓ 选择项目
2. ⏳ → 🔄 → ✓ 导航到 Commitments
3. ⏳ → 🔄 → ✓ 查找并打开 PO
4. ⏳ → 🔄 → ✓ 更新 PO 字段

**状态图标**：
- ⏳ 待执行（灰色）
- 🔄 执行中（旋转动画）
- ✓ 已完成（绿色删除线）

## 📸 效果演示

### 执行前
```
[页面正常显示]
```

### 执行中
```
┌─────────────────────────────┐
│  🤖 Invoice Automation      │  ← 右下角浮动面板
│  ────────────────────────   │
│  🔄 正在选择项目...         │
│                              │
│  ✓ 选择项目                 │  ← 步骤进度
│  🔄 导航到 Commitments      │
│  ⏳ 查找并打开 PO           │
│  ⏳ 更新 PO 字段            │
└─────────────────────────────┘

       ╔═══════════════════╗
       ║ 点击项目选择器    ║    ← 操作提示气泡
       ╚═══════════════════╝
                ▼
    ┏━━━━━━━━━━━━━━━━━━┓
    ┃ Project Picker   ┃    ← 高亮的元素（紫色发光）
    ┗━━━━━━━━━━━━━━━━━━┛
```

## 🚀 使用方法

### 1. 安装新版本

```bash
# 解压安装包
unzip InvoiceAutomation-ChromeExtension-v1.2.0.zip -d test-visual

# 在 Chrome 中加载
# chrome://extensions/ → 加载已解压的扩展程序
```

### 2. 配置 API Key

- 打开设置页面
- 配置 OpenAI API Key
- 保存设置

### 3. 测试自动化

1. **打开 Procore**
   - 访问任意 Procore 项目页面

2. **启动自动化**
   - 点击扩展图标
   - 上传 PDF 发票
   - 点击"开始自动化"

3. **观察效果**
   - ✅ 右下角出现紫色进度面板
   - ✅ 看到4个步骤列表
   - ✅ 当前步骤显示旋转图标
   - ✅ 被操作的元素会高亮
   - ✅ 元素上方显示操作说明
   - ✅ 页面自动滚动跟随操作

## 📊 操作时序

```
时间轴：

0s     初始化
       └─ 显示浮动面板
       └─ 初始化4个步骤

1s     步骤 1：选择项目
       └─ 高亮项目选择器（紫色边框）
       └─ 显示气泡："点击项目选择器"
       └─ 0.8秒后点击

5s     步骤 1 继续
       └─ 输入项目编号
       └─ 高亮匹配的选项
       └─ 显示气泡："选择项目: KIWIWASTE-006"
       └─ 0.8秒后点击

10s    步骤 2：导航到 Commitments
       └─ 更新进度（步骤1变为✓，步骤2变为🔄）
       └─ 高亮 Commitments 链接
       └─ 点击并导航

15s    步骤 3：查找并打开 PO
       └─ 更新进度
       └─ 高亮搜索框
       └─ 输入并搜索
       └─ 高亮匹配的 PO
       └─ 点击打开

20s    步骤 4：更新 PO 字段
       └─ 更新进度
       └─ 高亮编辑按钮 → 点击
       └─ 高亮标题输入框 → 填写
       └─ 高亮状态下拉菜单 → 选择

25s    完成
       └─ 所有步骤显示 ✓
       └─ 显示成功提示
       └─ 关闭浮动面板
```

## 🎨 视觉设计

### 颜色方案

| 元素 | 颜色 | 用途 |
|------|------|------|
| 高亮边框 | #667eea（紫色） | 标识正在操作的元素 |
| 浮动面板背景 | 紫色渐变 | 显示进度和状态 |
| 操作气泡 | 紫色渐变 | 显示操作说明 |
| 完成图标 | #4CAF50（绿色） | 标识完成的步骤 |
| 待执行图标 | 灰色半透明 | 标识未开始的步骤 |

### 动画效果

| 动画 | 时长 | 效果 |
|------|------|------|
| 高亮脉冲 | 1.5s | 边框阴影扩散 |
| 气泡弹跳 | 0.5s | 上下跳动 |
| 面板滑入 | 0.3s | 从右侧滑入 |
| 旋转加载 | 1s | 持续旋转 |

## 📐 尺寸规格

| 元素 | 尺寸 |
|------|------|
| 浮动面板 | 320px × 最大500px |
| 高亮边框 | 3px粗，2px偏移 |
| 操作气泡 | 自适应文字长度 |
| 步骤图标 | 20px × 20px |

## 🔍 调试技巧

### 查看元素高亮

```javascript
// 在 Console 中查看当前高亮的元素
document.querySelector('.ia-highlight-element')
```

### 查看当前步骤

```javascript
// 查看步骤进度
document.getElementById('ia-step-progress')
```

### 查看操作提示

```javascript
// 查看当前提示气泡
document.getElementById('ia-current-tooltip')
```

### 手动触发高亮

```javascript
// 测试高亮效果
const element = document.querySelector('button');
element.classList.add('ia-highlight-element');
```

## ⚙️ 自定义配置

### 调整高亮时长

编辑 `content-scripts/procore-automation.js`:

```javascript
async function clickWithFeedback(element, description) {
  highlightElement(element, description);
  await sleep(800);  // ← 修改这里（毫秒）
  element.click();
  await sleep(500);
  removeHighlight();
}
```

### 调整面板位置

编辑 `styles/content.css`:

```css
#ia-automation-overlay {
  position: fixed;
  bottom: 20px;   /* ← 距离底部 */
  right: 20px;    /* ← 距离右侧 */
  /* 修改为 left: 20px; 可移到左下角 */
}
```

### 修改颜色主题

编辑 `styles/content.css`:

```css
.ia-highlight-element {
  outline: 3px solid #667eea !important;  /* ← 边框颜色 */
}

.ia-overlay-content {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  /* ← 修改渐变颜色 */
}
```

## 📱 响应式设计

### 桌面端（默认）
- 浮动面板：320px宽
- 完整动画效果
- 自动滚动跟随

### 平板/小屏幕
- 浮动面板：自动缩小
- 简化动画
- 文字大小调整

### 移动端
- 浮动面板：全宽显示
- 最小化动画
- 触摸优化

## 🆚 对比

### 旧版本（v1.1.1）

```
❌ 全屏黑色遮罩
❌ 看不到页面操作
❌ 只有文字提示
❌ 不知道当前步骤
```

### 新版本（v1.2.0）

```
✅ 右下角浮动面板
✅ 完全看得到页面
✅ 元素高亮 + 提示气泡
✅ 实时步骤进度
✅ 平滑动画效果
```

## 🎯 实际效果

### 选择项目时

```
页面：显示项目列表
面板：🔄 正在选择项目...
      ✓ 选择项目 ← 当前
      ⏳ 导航到 Commitments
      ⏳ 查找并打开 PO
      ⏳ 更新 PO 字段

高亮：项目选择器（紫色发光）
气泡："点击项目选择器"
```

### 填写发票号时

```
页面：显示 PO 编辑表单
面板：🔄 正在更新字段...
      ✓ 选择项目
      ✓ 导航到 Commitments
      ✓ 查找并打开 PO
      🔄 更新 PO 字段 ← 当前

高亮：Title 输入框（紫色发光）
气泡："填写发票号: 335397"
```

### 完成时

```
页面：PO 详情页（已填写）
面板：已关闭
提示：✅ 自动化完成！请检查并保存更改。

所有步骤：
      ✓ 选择项目
      ✓ 导航到 Commitments
      ✓ 查找并打开 PO
      ✓ 更新 PO 字段
```

## ✅ 功能清单

- [x] 浮动进度面板（右下角）
- [x] 实时步骤进度显示
- [x] 元素高亮效果（紫色发光）
- [x] 操作提示气泡
- [x] 自动滚动跟随
- [x] 平滑动画过渡
- [x] 步骤状态图标（⏳/🔄/✓）
- [x] 不遮挡页面内容
- [x] 响应式设计
- [x] 可自定义样式

## 🐛 常见问题

### Q1: 看不到浮动面板？

**A**: 检查：
1. 确认使用的是 v1.2.0
2. 刷新 Procore 页面
3. 检查浏览器控制台错误
4. 确认 content.css 已加载

### Q2: 元素高亮不明显？

**A**: 可能原因：
1. 页面有其他高 z-index 元素覆盖
2. 元素本身有强样式优先级
3. 浏览器缩放影响

**解决**：
- 调整 `.ia-highlight-element` 的 z-index
- 增加 `!important` 优先级

### Q3: 操作提示显示位置不对？

**A**: 原因：
- 页面滚动导致位置计算偏移
- 元素动态位置变化

**解决**：
- 提示气泡会随滚动自动调整
- 如果仍有问题，检查元素是否在 iframe 中

### Q4: 步骤进度不更新？

**A**: 检查：
1. 控制台是否有 JavaScript 错误
2. `ia-step-progress` 元素是否存在
3. `nextStep()` 函数是否被正确调用

### Q5: 动画太快/太慢？

**A**: 调整时长：
- 修改 `sleep()` 的参数
- 修改 CSS 动画的 `animation-duration`
- 修改 `clickWithFeedback` 中的等待时间

## 📚 技术细节

### CSS 类名

| 类名 | 用途 |
|------|------|
| `.ia-automation-overlay` | 浮动面板容器 |
| `.ia-overlay-content` | 面板内容 |
| `.ia-step-progress` | 步骤进度容器 |
| `.ia-step-item` | 单个步骤 |
| `.ia-highlight-element` | 高亮元素 |
| `.ia-action-tooltip` | 操作提示气泡 |

### JavaScript 函数

| 函数 | 参数 | 功能 |
|------|------|------|
| `initializeSteps(steps)` | 步骤数组 | 初始化步骤列表 |
| `nextStep()` | 无 | 前进到下一步 |
| `updateStepProgress()` | 无 | 更新步骤显示 |
| `highlightElement(el, action)` | 元素，操作文字 | 高亮元素并显示提示 |
| `removeHighlight()` | 无 | 移除高亮 |
| `clickWithFeedback(el, desc)` | 元素，描述 | 带反馈的点击 |
| `fillWithFeedback(el, value, desc)` | 元素，值，描述 | 带反馈的填写 |

### 事件流程

```
用户点击"开始自动化"
  ↓
初始化步骤列表
  ↓
显示浮动面板
  ↓
步骤1：nextStep() → highlightElement() → 操作 → removeHighlight()
  ↓
步骤2：nextStep() → highlightElement() → 操作 → removeHighlight()
  ↓
步骤3：nextStep() → highlightElement() → 操作 → removeHighlight()
  ↓
步骤4：nextStep() → highlightElement() → 操作 → removeHighlight()
  ↓
隐藏面板 → 显示成功提示
```

## 🎉 总结

现在您可以：

✅ **清楚地看到**每一步操作
✅ **实时了解**当前进度
✅ **准确跟踪**自动化过程
✅ **及时发现**可能的问题
✅ **放心使用**自动化功能

---

**需要帮助？** 查看完整文档或联系技术支持。
